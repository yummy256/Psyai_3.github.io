<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI聊天室 - Judy</title>
    <!-- 移除ECharts CDN（不再需要图表） -->
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app-container">
        <!-- 整体三栏布局 -->
        <div class="layout">
            <!-- 左侧导航栏（新增清空按钮到底部） -->
            <div class="sidebar">
                <div class="sidebar-header">AI聊天室</div>
                <div class="sidebar-item active" data-view="chat">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    对话
                </div>
                <div class="sidebar-item" data-view="history">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0z"></path>
                        <path d="M12 8v4l3 3"></path>
                    </svg>
                    历史记录
                </div>
                <div class="sidebar-item" data-view="emotion">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                        <line x1="9" y1="9" x2="9.01" y2="9"></line>
                        <line x1="15" y1="9" x2="15.01" y2="9"></line>
                    </svg>
                    情感分析
                </div>
                <div class="sidebar-item" data-view="setting">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                    设置
                </div>
                <!-- 清空对话按钮移到左侧列表底部 -->
                <button class="clear-btn" onclick="clearChat()">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                        </path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    清空对话
                </button>
            </div>

            <!-- 中间主内容区 -->
            <div class="main-content">
                <!-- 顶部标题栏 -->
                <div class="main-header">
                    <h2>Judy-你的解忧小伙伴</h2>
                    <span class="tech-tip">欸，你来啦，欢迎哟~</span>
                </div>

                <!-- 对话视图（默认） -->
                <div class="chat-view-container view active">
                    <!-- 移除原左下角的清空按钮 -->

                    <!-- 聊天消息区 -->
                    <div class="chat-messages" id="chatMessages">
                        <!-- 欢迎消息 -->
                        <div class="message ai-message">
                            <div class="avatar ai-avatar">🤖</div>
                            <div class="message-content">
                                <strong>Judy：</strong>
                                <span>你好，我是Judy，一只会解忧的兔子，要和我聊聊吗~</span>
                            </div>
                        </div>
                        <!-- 消息列表由JS动态生成 -->
                    </div>

                    <!-- 输入区（增大尺寸） -->
                    <div class="chat-input">
                        <input type="text" id="inputMessage" placeholder="点击输入，按Enter发送，Shift+Enter换行..."
                            onkeydown="handleKeyDown(event)"
                            onfocus="inputFocused = true; this.classList.add('input-focused')"
                            onblur="inputFocused = false; this.classList.remove('input-focused')" maxlength="500">
                        <!-- 语音输入按钮（增大尺寸） -->
                        <button class="voice-btn" onclick="startVoiceInput()">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                        <button onclick="sendMessage()" class="send-btn" id="sendBtn" disabled>
                            发送
                        </button>
                        <!-- 字数统计 -->
                        <span class="word-count" id="wordCount">0/500</span>
                    </div>
                </div>

                <!-- 历史记录视图 -->
                <div class="history-view view">
                    <h3>历史会话</h3>
                    <div class="history-empty" id="historyEmpty">暂无历史会话</div>
                    <div id="historyList" class="history-list">
                        <!-- 历史会话由JS动态生成 -->
                    </div>
                </div>

                <!-- 情感分析视图（替换图表为动态emoji） -->
                <div class="emotion-view view">
                    <h3>详细情感分析</h3>
                    <div class="emotion-stats">
                        <div class="stat-item">
                            <span class="stat-label">积极占比</span>
                            <span class="stat-value" id="positiveRatio">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">中性占比</span>
                            <span class="stat-value" id="neutralRatio">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">消极占比</span>
                            <span class="stat-value" id="negativeRatio">0%</span>
                        </div>
                    </div>
                    <!-- 替换饼图为核心心情emoji -->
                    <div class="emotion-emoji-main" id="mainEmoji">😐</div>
                    <!-- 替换趋势图为心情变化轨迹 -->
                    <div class="emotion-track" id="emotionTrack">
                        <span class="track-label">心情变化轨迹：</span>
                        <div class="track-emojis" id="trackEmojis">暂无消息</div>
                    </div>
                </div>

                <!-- 设置视图 -->
                <div class="setting-view view">
                    <h3>系统设置</h3>
                    <div class="setting-item">
                        <label>Rasa API地址</label>
                        <input type="text" id="rasaApiUrl" placeholder="http://localhost:5005/webhooks/rest/webhook">
                    </div>
                    <button class="save-setting-btn" onclick="saveSetting()">保存设置</button>
                </div>
            </div>

            <!-- 右侧情感面板（替换折线图为动态emoji） -->
            <div class="right-panel">
                <div class="panel-header">
                    <h3>情感分析</h3>
                    <button class="close-panel" onclick="togglePanel()">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="panel-content" id="panelContent">
                    <div class="emotion-status">
                        <span class="status-label">当前情感状态</span>
                        <div class="status-tag">
                            <span id="currentEmotion" class="neutral">中性</span>
                        </div>
                    </div>
                    <!-- 核心心情emoji -->
                    <div class="panel-emoji" id="panelEmoji">😐</div>
                    <div class="emotion-recent">
                        <span class="recent-label">最近一条消息</span>
                        <div class="recent-emotion neutral" id="lastMessageEmotion">无</div>
                    </div>
                    <div class="emotion-distribution">
                        <span class="dist-label">情感分布</span>
                        <div class="dist-tags">
                            <span class="dist-tag positive">积极</span>
                            <span class="dist-tag neutral">中性</span>
                            <span class="dist-tag negative">消极</span>
                        </div>
                    </div>
                    <!-- 移除原趋势图，新增最近心情轨迹 -->
                    <div class="panel-track">
                        <span class="track-label">最近心情：</span>
                        <div class="track-emojis" id="panelTrackEmojis">暂无</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载动画模板（JS动态插入） -->
    <template id="loadingTemplate">
        <div class="loading">
            <div class="loading-spinner"></div>
            <span>组织语言ing...</span>
        </div>
    </template>

    <!-- 引入JS文件 -->
    <script src="script.js"></script>
</body>

</html>